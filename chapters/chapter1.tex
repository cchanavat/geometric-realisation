\section{From directed simplicial sets to d-spaces}

\subsection{Directed simplicial sets}

We call \( \Delta \) the simplex category whose objects are finite linear orders \( [n] = \{0 < \dots < n\} \) and morphisms are order-preserving functions.
It is generated by the coface maps \( \delta_i\colon [n-1] \to [n] \) and the codegeneracy maps \( \sigma_j\colon [n+1] \to [n] \).

\begin{cdef}{Direction on a simplex}{direction_on_simplex}
	A \cemph{direction} on the \( n \)-simplex is a reflexive relation \( P \subseteq [n] \times [n] \).
\end{cdef}

\begin{cdef}{Directed simplex}{directed_simplex}
	The \cemph{directed simplex} category \( \dDelta \) is the category whose
	\begin{itemize}
		\item objects are dependent pairs \( ([n], P \subseteq [n] \times [n])  \), where \( P \) is a direction on \( [n] \),
		\item morphisms from \( ([n], P) \) to \( ([m], Q) \) are functions \( f\colon [n] \to [m] \) which preserve both the order and the direction, that is, for all \( i, j \in [n] \), \( i \leq j \) implies \( f(i) \leq f(j) \) and \( i P j \) implies \( f(i) Q f(j) \). 
	\end{itemize}
\end{cdef}
We embed \( \Delta \) as a full subcategory of \( \dDelta \) by sending \( [n] \) to \( ([n], [n] \times [n]) \).
Note that this is \emph{not} the same as the definition used in Gylfi's note; we still need to work out a comparison.

As in \( \Delta \), we have a factorisation result.
\begin{clem}{Factorisation}{facto_maps}
    Any map \( f\colon ([n], P) \to ([m], Q) \) factorizes as 
    \begin{equation*}
    	f = d_{i_1}\dots d_{i_p}s_{j_1}\dots s_{j_q}
    \end{equation*}
    where the orderings are constructed iteratively, starting from \( P \), that is:
    \begin{equation*}
        s_{j_k}\colon ([n], s_{j_{k+1}}\dots s_{j_q}(P)) \to ([n - k], s_{j_k}s_{j_{k+1}}\dots s_{j_q}(P)) 
    \end{equation*}
    and similarly for \( d_{i_k} \), except for \( d_{i_1}\colon ([n], d_{i_2}\dots d_{i_p}s_{j_1}\dots s_{j_q}(P)) \to ([m], Q) \) (or for \( s_{j_1} \) if \( p = 0 \)).
\end{clem} 
\begin{lemproof}{facto_maps}
    We use the decomposition from the underlying map \( f \) in \( \Delta \), and by construction, each \( s_{j_k}, d_{i_k} \) lift to \( \dDelta \).
\end{lemproof}

\begin{cdef}{Directed simplicial set}{directed_simplicial_set}
	A \cemph{directed simplicial set} is a presheaf on \( \dDelta \).
	We write \( \dsSet \) for the category of directed simplicial sets with morphisms of presheaves.
\end{cdef}


\subsection{Directed topological spaces}

\begin{cdef}{d-spaces and d-maps}{d_space}
	A \cemph{d-space} \( (X, dX) \) is a topological space together with a set \( dX \) of \emph{dipaths} \( \gamma\colon [0, 1] \to X \) such that
    \begin{enumerate}
	\item \emph{(closure under constant paths)} every constant path is a dipath,
	\item \emph{(closure under directed partial reparametrisations)}
		if \( \phi\colon [0, 1] \to [0, 1] \) is continuous and order-preserving, then \( \gamma \circ \phi \) is a dipath for all \( \gamma \in dX \),
	\item \emph{(closure under concatenation)} the concatenation of two dipaths is a dipath.
    \end{enumerate}
    A \cemph{d-map} (or dimap) \( f\colon (X, dX) \to (Y, dY) \) is a continuous map such that for all \( \gamma \in dX \), \( f \circ \gamma \in dY \).
    With d-maps as morphisms, d-spaces form a category \( \dTop \).
\end{cdef}

Given a set of paths, we can consider the smallest set of dipaths that contains it.

\begin{cdef}{Generated dipaths}{dipaths_generated}
	Let \( X \) be a topological space and \( \Gamma \) a set of paths in \( X \).
	The \cemph{set of dipaths generated by \( \Gamma \)} is the smallest set of paths \( dX(\Gamma) \) containing \( \Gamma \) and closed under constant paths, directed partial reparametrisation, and concatenation.
\end{cdef}

\begin{cdef}{Piecewise partial \( \Gamma \)-paths}{piecewise_gamma}
	Let \( X \) be a topological space and \( \Gamma \) a set of paths in \( X \).
	A path \( \gamma\colon [0, 1] \to X \) is a \cemph{piecewise partial \( \Gamma \)-path} if there exist
	\begin{enumerate}
		\item a finite subdivision \( (0 = a_0 < \ldots < a_{n+1} = 1) \) of \( [0, 1] \),
		\item a family of order-preserving continuous maps \( (\varphi_i\colon [a_i, a_{i+1}] \to [0, 1])_{i=0}^n \), and
		\item a family of paths \( (\gamma_i\colon [0, 1] \to X)_{i=0}^n \) in \( \Gamma \),
	\end{enumerate}
	such that, for all \( i \in \interval{0}{n} \), 
	\begin{equation*}
		\restr{\gamma}{[a_i, a_{i+1}]} = \gamma_i \circ \varphi_i.
	\end{equation*}
	We write \( \Gamma_\textit{pp} \) for the set of piecewise partial \( \Gamma \)-paths.
\end{cdef}

\begin{clem}{Characterisation of generated dipaths}{char_generated_dipaths}
	Let \( X \) be a topological space and \( \Gamma \) a set of paths in \( X \).
	Let
	\begin{equation*}
		\neg \Gamma \defeq
		\{ x! \mid x \in X \setminus \bigcup_{\gamma \in \Gamma} \gamma[0, 1] \},
	\end{equation*}
	where \( x! \) is the constant path at \( x \).
	Then
	\begin{equation*}
		dX(\Gamma) = \Gamma_\textit{pp} + \neg \Gamma.
	\end{equation*}
\end{clem}
\begin{lemproof}{char_generated_dipaths}
It suffices to show that
\begin{enumerate}
	\item \( \Gamma_\textit{pp} + \neg \Gamma \) is generated by \( \Gamma \) under constant paths, directed partial reparametrisation, and concatenation, and
	\item it is itself closed under these operations.
\end{enumerate}
The first point is trivial for \( \neg \Gamma \), since it consists only of constant paths.
Let \( \gamma \in \Gamma_\textit{pp} \), and let \( (a_i)_{i=0}^{n+1}, (\varphi_i)_{i=0}^n, (\gamma_i \in \Gamma)_{i=0}^n \) be given as in \citedef{piecewise_gamma}.
Then \( \gamma \) can be obtained by
\begin{enumerate}
	\item precomposing each \( \gamma_i \) with \( t \mapsto \varphi_i(a_i + (a_{i+1} - a_i)t) \);
	\item concatenating all the resulting paths;
	\item reparametrising piecewise linearly in such a way that the \( i \)-th factor in the concatenation is defined on \( [a_i, a_{i+1}] \).
\end{enumerate}
Next, we prove that every constant path \( x! \) is contained in \( \Gamma_\textit{pp} + \neg \Gamma \).
If \( x \) is not in the image of any \( \gamma \in \Gamma \), then by definition \( x! \in \neg \Gamma \).
Otherwise, there exist \( \gamma \in \Gamma \) and \( t_x \in [0, 1] \) such that \( x = \gamma(t_x) \).
It follows that \( x! \) is equal to the partial piecewise \( \Gamma \)-path obtained from
\begin{equation*}
	(a_0 = 0 < 1 = a_1), \quad \varphi_0\colon t \mapsto t_x, \quad \gamma_0 \defeq \gamma.
\end{equation*}

Next, we show that both \( \Gamma_\textit{pp} \) and \( \neg \Gamma \) are separately closed under directed partial reparametrisation.
For \( \neg \Gamma \), this is immediate.
Let \( \gamma \in \Gamma_\textit{pp} \) be obtained from \( (a_i)_{i=0}^{n+1}, (\varphi_i)_{i=0}^n, (\gamma_i \in \Gamma)_{i=0}^n \), and let \( \psi\colon [0, 1] \to [0, 1] \) be a directed partial reparametrisation.
Let
\begin{equation*}
	b_i \defeq \begin{cases}
		0 & \text{ if \( a_i \leq \psi(0) \) }, \\
		\min \invrs{\psi}(a_i) & \text{ if \( \psi(0) < a_i < \psi(1) \) }, \\
		1 & \text{ if \( \psi(1) \leq a_i \) }.
	\end{cases}
\end{equation*}
This is well-defined since \( \invrs{\psi}(a_i) \) is closed and bounded, so it has a minimum whenever it is non-empty, which is always true when \( a_i \in [\psi(0), \psi(1)] \) because \( \psi \) is order-preserving and continuous.
Moreover \( 0 = b_0 \leq \ldots \leq b_{n+1} = 1 \).
We define, recursively on \( i \leq m \defeq | \{b_0, \ldots, b_{n+1} \} | - 1 \),
\begin{align*}
	k(0) & \defeq 0, \\
	k(i+1) & \defeq \min \{ j \mid b_j > b_{k(i)} \},
\end{align*}
and finally 
\begin{equation*}
	c_i \defeq b_{k(i)}, \quad i \in \interval{0}{m+1}
\end{equation*}
where by construction \( 0 = c_0 < \ldots < c_{m+1} = 1 \).
Then \( \gamma \circ \psi \) is obtained from
\begin{equation*}
	(c_i)_{i=0}^{m+1}, \quad (\varphi_{k(i)} \circ \restr{\psi}{[c_i, c_{i+1}]})_{i=0}^m, \quad (\gamma_{k(i)})_{i=1}^{m+1}.
\end{equation*}

Finally, \( \neg \Gamma \) is trivially closed under concatenation, and it is straightforward to show the same for \( \Gamma_\textit{pp} \).
To conclude, it suffices to observe that no endpoint of a path in \( \Gamma_\textit{pp} \) can match an endpoint of a path in \( \neg \Gamma \), so no other concatenation is possible.
\end{lemproof}

\begin{clem}{Maps preserving generating paths}{maps_preserving_generating_paths}
Let \( f\colon X \to Y \) be a continuous map, \( \Gamma \) a set of paths in \( X \) and \( \Theta \) a set of paths in \( Y \).
Suppose that, for all \( \gamma \in \Gamma \), we have \( f \circ \gamma \in \Theta \).
Then \( f\colon (X, dX(\Gamma)) \to (Y, dY(\Theta)) \) is a dimap.
\end{clem}
\begin{proof}
Let \( \gamma \in dX(\Gamma) \).
If \( \gamma \) is constant, then necessarily so is \( f \circ \gamma \), and there is nothing to prove.
Otherwise, by \citelem{char_generated_dipaths}, \( \gamma \in \Gamma_\textit{pp} \) is obtained from some \( (a_i)_{i=0}^{n+1}, (\varphi_i)_{i=0}^n, (\gamma_i \in \Gamma)_{i=0}^n \).
Then \( f \circ \gamma \) is obtained from
\begin{equation*}
	(a_i)_{i=0}^{n+1}, (\varphi_i)_{i=0}^n, (f \circ \gamma_i \in \Theta)_{i=0}^n, 
\end{equation*}
so it is a piecewise partial \( \Theta \)-path.
\end{proof}


\subsection{Geometric realisation of directed simplicial sets}

We want to define a left adjoint geometric realisation functor \( \dirgeo{-}\colon \dsSet \to \dTop \).
Because \( \dTop \) is cocomplete and \( \dsSet \) is a category of presheaves on a small category, it suffices to define \( \dirgeo{-} \) on \( \dDelta \), then take the left Kan extension along its Yoneda embedding.

\begin{ccon}{Elementary paths}{elementary_paths}
	Let \( \bbR^\infty \) be the space of sequences \( x = (x_i)_{i \in \bbN} \) of real numbers such that \( x_i = 0 \) for all but finitely many indices, with the topology that makes it a colimit of the sequence of inclusions 
	\fun{ \imath_n }
	{ \bbR^n }
	{ \bbR^{n+1} }
	{ (x_0, \ldots, x_{n-1}) }
	{ (x_0, \ldots, x_{n-1}, 0). }
	Then \( \bbR^\infty \) has a structure of topological real vector space, with
	\begin{equation*}
		x + y \defeq (x_i + y_i)_{i \in \bbN}, \qquad
		r x \defeq (r x_i)_{i \in \bbN}
	\end{equation*}
	for all \( x, y \in \bbR^\infty \) and \( r \in \bbR \).

	For each \( i \in \bbN \), we let \( e_i \) be the point of \( \bbR^\infty \) defined by
	\begin{equation*}
		e_{ij} \defeq \begin{cases}
			1 & \text{if \( i = j \)}, \\
			0 & \text{otherwise}.
		\end{cases}
	\end{equation*}
	For each \( i, j \in \bbN \), we let \( \gamma_{ij}\colon [0, 1] \to \bbR^\infty \) be the path defined by
	\begin{equation*}
		t \mapsto (1 - t)e_i + te_j.
	\end{equation*}
	Notice that \( \gamma_{ij}(0) = e_i \) and \( \gamma_{ij}(1) = e_j \).
\end{ccon}

\begin{cdef}{Geometric realisation of directed simplicial sets}{geom_real}
	The \cemph{geometric realisation} of a directed simplex \( ([n], P) \) is the directed topological space \( (\Delta^n, d\Delta^n(\Gamma_P)) \) where 
\begin{itemize}
	\item \( \Delta^n \) is the convex hull spanned by \( e_0, \ldots, e_n \) in \( \bbR^\infty \), that is, the closed subspace
		\begin{equation*}
			\{ \sum_{i=0}^n c_i e_i \mid c_i \geq 0, \sum_{i}c_i = 1 \},
		\end{equation*}
	\item \( \Gamma_P \) is the set of paths
		\begin{equation*}
			\{ t \mapsto \sum_{iPj} c_{ij} \gamma_{ij}(t) \mid c_{ij} \geq 0, \sum_{iPj} c_{ij} = 1 \}.
		\end{equation*}
\end{itemize}
This extends to a a functor \( \dirgeo{-}\colon \dDelta \to \dTop \), sending \( f\colon ([n], P) \to ([m], Q) \) to the continuous map
\begin{equation*}
	\dirgeo{f} \colon \sum_{i=0}^n c_i e_i \mapsto \sum_{i=0}^n c_i e_{f(i)} = \sum_{j=0}^m c'_j e_j,
\end{equation*}
where 
\begin{equation*}
	c'_j \defeq \sum_{j = f(i)} c_i.
\end{equation*}
The \emph{geometric realisation of directed simplicial sets} is the functor \( \dirgeo{-}\colon \dsSet \to \dTop \) obtained by taking the left Kan extension of \( \dirgeo{-}\colon \dDelta \to \dTop \) along the Yoneda embedding.
\end{cdef}

Observe that \( \dirgeo{f} \) can be extended (non-uniquely) to a linear operator on \( \bbR^\infty \).

\begin{clem}{The functor \( \dirgeo{-} \) is well-defined}{dirgeo_well_defined}
	The functor \( \dirgeo{-} \) is well-defined, that is, if \( f\colon ([n], P) \to ([m], Q) \) is a map of directed simplices, then \( \dirgeo{f} \) is a dimap.
\end{clem}
\begin{lemproof}{dirgeo_well_defined}
By \citelem{maps_preserving_generating_paths}, it suffices to show that, if \( \gamma \in \Gamma_P \), then \( \dirgeo{f} \circ \gamma \in \Gamma_Q \).
Let \( \gamma \) be the generating path \( t \mapsto \sum_{iPj} c_{ij} \gamma_{ij}(t) \).
Then \( \dirgeo{f} \circ \gamma \) is, by linearity,
\begin{align*}
	t \mapsto \sum_{iPj} c_{ij} \dirgeo{f}(\gamma_{ij}(t)) 
	& = \sum_{iPj} c_{ij} ((1-t) e_{f(i)} + te_{f(j)}) = \\
	& = \sum_{iPj} c_{ij} \gamma_{f(i)f(j)}(t) = \sum_{kQ\ell} c'_{k\ell} \gamma_{k\ell}(t),
\end{align*}
where
\begin{equation*}
	c'_{k\ell} \defeq \sum_{iPj, k=f(i), \ell=f(j)} c_{ij},
\end{equation*}
which is a path in \( \Gamma_Q \).
\end{lemproof}

Notice that, since the relation \( P \) is reflexive, \( \Gamma_P \) already contains all constant paths, obtained as convex combinations \( t \mapsto \sum_{i} c_i \gamma_{ii}(t) \).
